{
  "created_at": "2026-02-08T08:27:40.989915Z",
  "epic": {
    "data": {
      "branch_name": "fn-1-surface-go-3-fedora-install-script",
      "completion_review_status": "unknown",
      "completion_reviewed_at": null,
      "created_at": "2026-02-06T22:47:07.282103Z",
      "default_impl": null,
      "default_review": null,
      "default_sync": null,
      "depends_on_epics": [],
      "id": "fn-1-surface-go-3-fedora-install-script",
      "next_task": 1,
      "plan_review_status": "unknown",
      "plan_reviewed_at": "2026-02-08T08:27:18.464090Z",
      "spec_path": ".flow/specs/fn-1-surface-go-3-fedora-install-script.md",
      "status": "open",
      "title": "Surface Go 3 Fedora Install Script",
      "updated_at": "2026-02-08T08:27:18.464462Z"
    },
    "spec": "# Surface Go 3 Fedora Install Script\n\n## Overview\n\nBuild an idempotent Bash install script for **Fedora 43** on a Surface Go 3 (4GB RAM, Intel Pentium Gold 6500Y). A Kickstart file automates the base Fedora installation from the **Everything (netinstall) ISO** with Minimal Install (no desktop environment, no display manager). After first boot, `install.sh` sources modular function files from `lib/`, each defining functions only. The script runs all stages sequentially with `--only`/`--skip`/`--list` CLI support. After running once and rebooting, the machine boots into a fully configured Hyprland desktop with Tokyo Night theming.\n\n## Target Platform\n\n- **OS**: Fedora 43 (released Oct 2025, kernel 6.17)\n- **Base Image**: Fedora Everything (netinstall) ISO \u2192 Minimal Install\n- **Hardware**: Surface Go 3 \u2014 Intel Pentium Gold 6500Y (AES-NI capable), 4GB LPDDR3, eMMC storage (`/dev/mmcblk0`)\n- **No encryption**: Plain ext4, no LUKS (eMMC is soldered, low theft-data risk)\n\n## Scope\n\n- `kickstart/surface-go3.ks` \u2014 Automated Anaconda partitioning + minimal install + bootstrap\n- `install.sh` entry point + modular lib files\n- Omarchy-inspired template system (colors.toml \u2192 sed \u2192 .tpl files)\n- Full config tree for Hyprland 0.53+ (new windowrule syntax), waybar, mako, ghostty, tofi, hyprlock, hypridle, hyprpaper\n- Config deployment via symlinks from repo to `~/.config/`\n- Pre-built binary management (Impala, bluetui)\n- LazyVim + Tokyo Night Neovim setup\n- Full USB preparation guide in README\n\n## Kickstart File (`kickstart/surface-go3.ks`)\n\nAutomates the Fedora installation via Anaconda:\n- **Disk target**: `ignoredisk --only-use=mmcblk0` (auto-detect eMMC, ignore USB)\n- **Partitioning**: EFI 512MB + ext4 root (rest of disk), no swap partition (zram handles it)\n- **No encryption**: Plain ext4\n- **User account**: Prompted interactively via `%pre` script at boot time\n- **Package selection**: Minimal Install (no desktop, no display manager)\n- **Post-install bootstrap**: Installs git, clones repo to `/home/<user>/surface-linux` using a `REPO_URL` placeholder, prints instructions. User runs `install.sh` manually after first boot.\n- **Repo URL**: Placeholder `REPO_URL` that user edits before writing USB\n\n## Package Sources (Fedora 43)\n\n### COPR Repositories (4 total)\n1. **sdegler/hyprland** \u2014 Full Hyprland ecosystem (ABI-compatible set):\n   - hyprland 0.53.3+, hyprlock, hypridle, hyprpaper, hyprpolkitagent, hyprland-guiutils, waybar-git, cliphist\n2. **scottames/ghostty** \u2014 Ghostty terminal emulator\n3. **alternateved/tofi** \u2014 tofi app launcher (prebuilt RPM, no build-from-source needed)\n4. **linux-surface** (f43 repo, fixed Jan 2026) \u2014 kernel-surface, iptsd, libwacom-surface\n\n### Fedora Official Repos\n- grim, slurp (screenshots), mako (notifications), wireplumber (audio), NetworkManager, plymouth, neovim, iwd\n- All system/build dependencies (curl, jq, etc.)\n\n### Pre-built Binaries (GitHub Releases)\n- Impala v0.7.3 \u2014 WiFi TUI (`impala-${ARCH}-unknown-linux-musl`)\n- bluetui v0.8.1 \u2014 Bluetooth TUI (`bluetui-${ARCH}-linux-musl`)\n\n### Key Fedora 43 Changes from Original Spec\n- **Hyprland NOT in official repos** \u2014 dropped from Fedora 43, must use sdegler COPR\n- **solopasha COPR abandoned** \u2014 replaced by sdegler/hyprland\n- **hyprland-qt-support \u2192 hyprland-guiutils** \u2014 package renamed in COPR\n- **Hyprland 0.53+ windowrule syntax** \u2014 new `windowrule = ..., match:class ...` format (old `windowrulev2` deprecated)\n- **Ghostty NOT in official repos** \u2014 use scottames/ghostty COPR\n- **tofi via COPR** \u2014 alternateved/tofi replaces build-from-source approach\n- **dnf5 plugins** \u2014 explicitly install `dnf5-command(copr)` and `dnf5-command(config-manager)` first (may not be in Minimal Install)\n- **linux-surface f43 repo** \u2014 available since Jan 2026 (was missing at Fedora 43 launch)\n- **Full package audit needed** \u2014 verify all packages from original spec exist in Fedora 43 repos during implementation\n\n## Research Findings (Resolved Open Questions)\n\n| Question | Answer | Source |\n|----------|--------|--------|\n| Fedora version | Fedora 43 (current stable, Oct 2025) | Fedora Project |\n| Base image | Everything (netinstall) \u2192 Minimal Install | Community recommendation |\n| Hyprland source | sdegler/hyprland COPR (0.53.3+) | Fedora Discussion |\n| Ghostty source | scottames/ghostty COPR | ghostty.org docs |\n| tofi source | alternateved/tofi COPR (prebuilt RPM) | Fedora COPR |\n| linux-surface f43 | Available since Jan 2026 | GitHub issue #1896 |\n| LUKS encryption | No \u2014 AES-NI supported but unnecessary (soldered eMMC) | Intel specs |\n| Kickstart approach | Omarchy-inspired: automate base install, manual script run after | Omarchy manual |\n| Disk partitioning | Kickstart: ignoredisk mmcblk0, EFI 512MB + ext4 root, zram for swap | Kickstart docs |\n| User account | Prompted interactively in Kickstart %pre | Design decision |\n| dnf5 repo syntax | `dnf config-manager addrepo --from-repofile=URL` (NOT `--add-repo`) | Fedora Discussion |\n| UWSM availability | In sdegler/hyprland COPR | COPR package list |\n| Impala version | v0.7.3 (pinned) | GitHub releases |\n| bluetui version | v0.8.1 (pinned) | GitHub releases |\n| power-profiles-daemon | Fedora 43 uses tuned + tuned-ppd (same powerprofilesctl CLI) | Fedora Wiki |\n| set -e variant | Use `set -Eeuo pipefail` | Best practices |\n| Template placeholders | `{{ key }}`, `{{ key_strip }}` (no #), `{{ key_rgb }}` (decimal RGB) | Omarchy source |\n| XDG portal config | `~/.config/xdg-desktop-portal/portals.conf` | XDG docs |\n| Hyprland config syntax | 0.53+ anonymous windowrule syntax | Hyprland changelog |\n| Neovim setup | LazyVim + Tokyo Night (like Omarchy) | Design decision |\n| Shell aliases | Include n=nvim, ll, la etc. in .bashrc | Design decision |\n\n## Idempotency Definition\n\n\"Idempotent\" means: **no errors; converges to the same end-state; no duplicate snippets, backups, or repeated expensive work.** Observable changes like log file timestamps, dnf metadata refresh, and template regeneration (file overwrites to same content) are acceptable. The key guarantee is that running the script twice does not break anything or accumulate side effects.\n\n## Key Gotchas\n\n1. **kernel-surface needs `--allowerasing`** flag to replace stock kernel\n2. **iwd**: Do NOT enable `iwd.service` manually \u2014 NetworkManager manages it. Must `restorecon -R /etc/NetworkManager` after creating conf.d files (SELinux)\n3. **Getty auto-login**: Blank `ExecStart=` line REQUIRED before new one. Must use single-quoted heredoc to preserve `$TERM` literal. Must run `systemctl daemon-reload` after.\n4. **Plymouth**: Check current theme before rebuilding initrd with `-R` (saves ~30s)\n5. **zram config**: Write to `/etc/systemd/zram-generator.conf` (NOT `/usr/lib/`). Takes effect after reboot.\n6. **Symlinks**: Use `ln -snf` (with `-n` flag) to prevent nested symlinks\n7. **curl downloads**: Always use `-fSL` (fail on HTTP errors)\n8. **NetworkManager iwd switch drops WiFi**: Run network config AFTER all downloads complete\n9. **UWSM**: Add `uwsm check may-start` to `~/.bash_profile`, NOT `.bashrc`\n10. **Complex Hyprland keybinds**: Wrap pipes/subshells in `sh -c` or use helper scripts in `~/.local/bin/`\n11. **GTK theme on TTY**: Use `settings.ini` files directly, NOT `gsettings`/`dconf` (no DBus session)\n12. **Wallpaper paths**: Copy wallpapers to `~/.local/share/wallpapers/surface-linux/` for stable absolute paths\n13. **dnf5 plugins**: Ensure `dnf5-command(copr)` and `dnf5-command(config-manager)` are installed BEFORE any COPR/repo operations\n14. **Missing critical packages**: waybar-git (from COPR, not waybar), mako, wireplumber must be in package list\n15. **Hyprland 0.53+ syntax**: Use `windowrule` not `windowrulev2`. New `match:class` format.\n16. **hyprland-guiutils replaces hyprland-qtutils** \u2014 old package name will fail\n\n## Neovim Configuration\n\n- Bootstrap LazyVim (lazy.nvim plugin manager + LazyVim distribution)\n- Set Tokyo Night as colorscheme\n- Ship `config/nvim/` directory with init.lua and lua/ config\n- Gets symlinked to `~/.config/nvim/` by dotfiles.sh\n- Includes LSP, treesitter, telescope out of the box via LazyVim defaults\n\n## Shell Aliases\n\nShip `.bashrc` additions via dotfiles:\n- `n` \u2192 `nvim`\n- `ll` \u2192 `ls -la`\n- `la` \u2192 `ls -A`\n- Other quality-of-life aliases as appropriate\n\n## Template Output Strategy\n\nTemplate-processed files (theme.conf, style.css, ghostty config, etc.) are written INTO the repo's config/ directory. This way they get symlinked by `dotfiles.sh` like everything else. Add generated files to `.gitignore`.\n\n## Bootstrap Flow\n\n1. User writes Fedora Everything ISO to USB\n2. User edits `kickstart/surface-go3.ks` to set REPO_URL\n3. User copies kickstart to USB or serves via HTTP\n4. Boot USB with `inst.ks=...` parameter\n5. Anaconda runs unattended: partitions eMMC, installs minimal system, clones repo\n6. Reboot \u2192 login to CLI\n7. Run `cd ~/surface-linux && ./install.sh`\n8. Reboot \u2192 Hyprland desktop via UWSM\n\n## Stage Ordering and Dependencies\n\n```\nrepos \u2192 kernel \u2192 packages \u2192 binaries \u2192 zram \u2192 network \u2192 desktop \u2192 theme \u2192 neovim \u2192 dotfiles \u2192 services\n```\n\nKey constraints:\n- `repos` must run first (adds COPR repos + linux-surface repo, installs dnf5 plugins)\n- `kernel` after repos (needs linux-surface repo)\n- `packages` after repos (needs COPR repos enabled)\n- `binaries` after packages (needs curl; downloads Impala + bluetui)\n- `network` after binaries (all downloads done; switching to iwd drops WiFi)\n- `theme` before dotfiles (generates config files that dotfiles symlinks)\n- `neovim` before or alongside dotfiles (LazyVim bootstrap)\n- `services` last (enables/restarts services after all config is in place)\n\nWhen using `--only`, the script should warn if running a stage without its prerequisites.\n\n## Quick Commands\n\n```bash\n# Full install\n./install.sh\n\n# List stages\n./install.sh --list\n\n# Run specific stage\n./install.sh --only packages\n\n# Skip a stage\n./install.sh --skip kernel\n```\n\n## Acceptance\n\n- [ ] Kickstart file automates Fedora 43 Minimal Install on Surface Go 3 eMMC\n- [ ] README includes full USB preparation guide (ISO + kickstart)\n- [ ] `./install.sh` runs to completion on fresh Fedora 43 Minimal Install\n- [ ] Idempotent: running twice produces no errors and converges to same end-state\n- [ ] `--only`, `--skip`, `--list` flags work correctly\n- [ ] System boots to Hyprland 0.53+ desktop via UWSM after reboot\n- [ ] Tokyo Night theme applied consistently across hyprland, waybar, ghostty, mako, tofi, hyprlock\n- [ ] All keybinds work: media keys, screenshots (grim+slurp), clipboard history (cliphist+tofi)\n- [ ] Waybar shows configured modules in single row\n- [ ] linux-surface kernel running with touchscreen (iptsd) working\n- [ ] WiFi via iwd/Impala, Bluetooth via bluetui\n- [ ] zram tuned to 4GB (verified after reboot)\n- [ ] Screen locks at 5min idle, suspends at 15min\n- [ ] Neovim launches with LazyVim + Tokyo Night theme\n- [ ] Shell aliases (n=nvim, ll, la) working\n- [ ] All symlinks correct from ~/.config/ to repo\n- [ ] Colored terminal output with stage progress during install\n- [ ] Log file at /tmp/surface-install.log\n- [ ] All 4 COPRs + linux-surface repo configured correctly\n- [ ] Hyprland config uses 0.53+ windowrule syntax throughout\n- [ ] hyprpolkitagent working for authentication prompts\n\n## References\n\n- [linux-surface Wiki](https://github.com/linux-surface/linux-surface/wiki/Installation-and-Setup)\n- [Hyprland Wiki](https://wiki.hypr.land/Configuring/)\n- [UWSM GitHub](https://github.com/Vladimir-csp/uwsm)\n- [Omarchy Theme System](https://deepwiki.com/basecamp/omarchy/6.1-theme-management)\n- [DNF5 Config-Manager](https://dnf5.readthedocs.io/en/latest/dnf5_plugins/config-manager.8.html)\n- [sdegler/hyprland COPR](https://copr.fedorainfracloud.org/coprs/sdegler/hyprland/packages/)\n- [scottames/ghostty COPR](https://copr.fedorainfracloud.org/coprs/scottames/ghostty/)\n- [alternateved/tofi COPR](https://copr.fedorainfracloud.org/coprs/alternateved/tofi/)\n- [Fedora 43 Hyprland Tutorial](https://discussion.fedoraproject.org/t/tutorial-fedora-43-install-hyprland-from-scratch/168386)\n- [Fedora Kickstart Docs](https://docs.fedoraproject.org/en-US/fedora/f35/install-guide/advanced/Kickstart_Installations/)\n- [JaKooLit/Fedora-Hyprland](https://github.com/JaKooLit/Fedora-Hyprland)\n- [LazyVim](https://www.lazyvim.org/)\n"
  },
  "epic_id": "fn-1-surface-go-3-fedora-install-script",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:08:51.731097Z",
        "depends_on": [],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.1",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.1.md",
        "status": "todo",
        "title": "Core framework: install.sh entry point + lib/00-common.sh + .gitignore",
        "updated_at": "2026-02-08T08:23:52.228254Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.1",
      "runtime": null,
      "spec": "## Description\n\nCreate the main entry point `install.sh` and shared library `lib/00-common.sh` that all stage scripts depend on. Also create the root `.gitignore`.\n\n**Size:** M\n**Files:** `install.sh`, `lib/00-common.sh`, `.gitignore`\n\n## Approach\n\n- `install.sh`: Source all `lib/*.sh` files in sorted order, parse `--only`/`--skip`/`--list` CLI flags, run stages sequentially from the STAGES array\n- `lib/00-common.sh`: Define shared functions (logging with color, `info`/`warn`/`error`/`success`, `require_root`, `is_installed`, `stage_header`), constants (`REPO_DIR`, `CONFIG_DIR`, `LOG_FILE`), and the `STAGES` array\n- `.gitignore`: Ignore `.idea/`, generated config files from template processing, `*.log`\n- Use `set -Eeuo pipefail` + `shopt -s inherit_errexit` as the strict-mode preamble\n- Separate `local` declaration from assignment to avoid masking failures (see practice-scout: `local var; var=$(cmd)`)\n- Trap on EXIT for cleanup, trap on ERR for diagnostic line/command info\n- Log to `/tmp/surface-install.log` with tee\n- Stage ordering: `repos \u2192 kernel \u2192 packages \u2192 binaries \u2192 zram \u2192 network \u2192 desktop \u2192 theme \u2192 neovim \u2192 dotfiles \u2192 services`\n- `--only <stage>` should warn if running without prerequisites (e.g., running `packages` without `repos`)\n- Each lib file defines a `run_<stage>()` function; `install.sh` calls them in order\n\n## Key context\n\n- `lib/` files define functions only \u2014 no top-level execution. `install.sh` sources them then invokes `run_<stage>()`.\n- Stages `repos` through `binaries` need network; `network` stage switches to iwd which drops WiFi. Order matters.\n- `set -e` inside conditionals (`if`, `&&`, `||`) silently disables `errexit` for nested calls \u2014 critical commands should have explicit checks.\n- Split `local` and assignment: `local var; var=$(cmd)` \u2014 otherwise `local` masks the exit code.\n\n## Acceptance\n\n- [ ] `./install.sh --list` prints all 11 stages in order\n- [ ] `./install.sh --only <stage>` runs only that stage with prerequisite warning\n- [ ] `./install.sh --skip <stage>` skips that stage\n- [ ] Colored output: stage headers, info (blue), warn (yellow), error (red), success (green)\n- [ ] Log file written to `/tmp/surface-install.log`\n- [ ] `set -Eeuo pipefail` + `shopt -s inherit_errexit` in both files\n- [ ] ERR trap shows failing command and line number\n- [ ] `.gitignore` covers `.idea/`, generated config files, log files\n- [ ] All lib files sourceable without side effects (functions only)\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:09:05.470206Z",
        "depends_on": [
          "fn-1-surface-go-3-fedora-install-script.1"
        ],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.2",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.2.md",
        "status": "todo",
        "title": "Repository setup, kernel, packages, and pre-built binaries (Fedora 43)",
        "updated_at": "2026-02-08T08:24:21.043847Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.2",
      "runtime": null,
      "spec": "## Description\n\nCreate 4 lib scripts covering the `repos`, `kernel`, `packages`, and `binaries` install stages for Fedora 43. This is the core package management task \u2014 installs dnf5 plugins, enables 4 COPRs + linux-surface repo, installs the Surface kernel, installs all desktop packages, and downloads pre-built binaries.\n\n**Size:** M\n**Files:** `lib/01-repos.sh`, `lib/02-kernel.sh`, `lib/03-packages.sh`, `lib/04-binaries.sh`\n\n## Approach\n\n### lib/01-repos.sh (`run_repos`)\n- Install dnf5 plugins first: `dnf5-command(copr)`, `dnf5-command(config-manager)` \u2014 may be missing on Minimal Install\n- Enable 4 COPRs idempotently: `sudo dnf5 -y copr enable sdegler/hyprland`, `scottames/ghostty`, `alternateved/tofi`\n- Add linux-surface repo: `sudo dnf5 config-manager addrepo --from-repofile=https://pkg.surfacelinux.com/fedora/linux-surface.repo --overwrite`\n- Use `--overwrite` for idempotent repo additions\n- Remove stale solopasha COPR if present: `sudo dnf copr remove solopasha/hyprland 2>/dev/null || true`\n\n### lib/02-kernel.sh (`run_kernel`)\n- Install `kernel-surface iptsd libwacom-surface` with `--allowerasing` flag (replaces stock kernel)\n- Enable `iptsd.service` for touchscreen\n\n### lib/03-packages.sh (`run_packages`)\n- Single `dnf install -y` with complete package list (dnf is already idempotent \u2014 returns 0 if installed)\n- COPR packages: `hyprland`, `hyprlock`, `hypridle`, `hyprpaper`, `hyprpolkitagent`, `hyprland-guiutils`, `waybar-git` (NOT `waybar`), `cliphist`, `ghostty`, `tofi`, `uwsm`, `xdg-desktop-portal-hyprland`\n- Official repos: `grim`, `slurp`, `mako`, `wireplumber`, `NetworkManager`, `plymouth`, `neovim`, `iwd`, `polkit`, `wl-clipboard`\n- System tools: `curl`, `jq`, `git`, `unzip`, `tree-sitter-cli` (for LazyVim)\n- Verify: full package list must be audited against Fedora 43 repos during implementation\n\n### lib/04-binaries.sh (`run_binaries`)\n- Download Impala v0.7.3 and bluetui v0.8.1 from GitHub Releases\n- Use `curl -fSL` (fail on HTTP errors)\n- Install to `~/.local/bin/` with `chmod +x`\n- Skip download if binary already exists and matches expected version (check `--version` output)\n- Detect architecture: `ARCH=$(uname -m)` \u2192 map to download URL pattern\n\n## Key context\n\n- `waybar-git` (from sdegler COPR) NOT `waybar` (Fedora repos) \u2014 different package\n- `hyprland-guiutils` NOT `hyprland-qtutils` \u2014 renamed package\n- dnf5 `copr enable` syntax: `-y` flag is a GLOBAL option BEFORE subcommand: `dnf5 -y copr enable ...`\n- `--allowerasing` is REQUIRED for kernel-surface (replaces stock kernel deps)\n- All downloads in this task complete BEFORE the network stage switches to iwd (drops WiFi)\n\n## Acceptance\n\n- [ ] dnf5 plugins installed before any COPR/repo operations\n- [ ] All 4 COPRs enabled: sdegler/hyprland, scottames/ghostty, alternateved/tofi, linux-surface\n- [ ] `kernel-surface`, `iptsd`, `libwacom-surface` installed with `--allowerasing`\n- [ ] All Hyprland ecosystem packages from COPR installed (hyprland, hyprlock, hypridle, hyprpaper, hyprpolkitagent, hyprland-guiutils, waybar-git, cliphist, uwsm, xdg-desktop-portal-hyprland)\n- [ ] ghostty and tofi installed from their respective COPRs\n- [ ] Official repo packages installed: grim, slurp, mako, wireplumber, neovim, iwd, plymouth\n- [ ] Impala v0.7.3 and bluetui v0.8.1 downloaded to `~/.local/bin/`\n- [ ] Idempotent: re-running produces no errors (dnf returns 0, binary skip if version matches)\n- [ ] No build-from-source steps (all packages via COPR or pre-built binaries)\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:09:05.645123Z",
        "depends_on": [],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.3",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.3.md",
        "status": "todo",
        "title": "Kickstart file, README with USB guide, and bootstrap docs",
        "updated_at": "2026-02-08T08:24:47.481953Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.3",
      "runtime": null,
      "spec": "## Description\n\nCreate the Kickstart file for automated Fedora 43 Minimal Install on Surface Go 3 eMMC, plus README.md with full USB preparation guide.\n\n**Size:** M\n**Files:** `kickstart/surface-go3.ks`, `README.md`\n\n## Approach\n\n### kickstart/surface-go3.ks\n- Target eMMC: `ignoredisk --only-use=mmcblk0`\n- Use `zerombr` to suppress MBR wipe prompt\n- Partitioning: `clearpart --all --initlabel --disklabel=gpt --drives=mmcblk0`\n- `reqpart --add-boot` for auto EFI System Partition (Fedora 43 default /boot is 2 GiB)\n- Root partition: `part / --fstype=ext4 --grow --ondisk=mmcblk0`\n- No swap partition (zram handles it)\n- No LUKS encryption (plain ext4)\n- `%pre` script: Interactive username prompt via bash `read` (Anaconda terminal)\n- Write user info to `/tmp/user-include` for `%include`\n- `@^minimal-environment` package group (no desktop, no display manager)\n- `%post`: Install git, clone repo using `REPO_URL` placeholder to `/home/<user>/surface-linux`, set ownership, print instructions\n- `%post` must handle file ownership: `chown -R $USER:$USER /home/$USER/surface-linux`\n- Boot parameter: `inst.ks=hd:LABEL=YOURFS:/ks/surface-go3.ks` or `inst.ks=http://...`\n- Avoid deprecated kickstart commands: no `authconfig`, no `autostep`, no `device`\n- Use `rootpw --lock` (no root password, sudo via wheel group)\n\n### README.md\n- Project overview and hardware target\n- USB preparation: download Everything ISO, copy kickstart, boot parameters\n- Two methods: kickstart on USB partition, or HTTP serve\n- Post-install: login, run `./install.sh`, reboot\n- Quick command reference (`--list`, `--only`, `--skip`)\n- Link to Fedora Kickstart docs and linux-surface wiki\n\n## Key context\n\n- Fedora 43 Anaconda uses DNF5 backend and requires GPT for UEFI (`--disklabel=gpt`)\n- Default `/boot` partition increased to 2 GiB in Fedora 43 \u2014 `reqpart --add-boot` handles this\n- eMMC partitions use `mmcblk0p1` naming (with `p` separator), not `sda1` style\n- `%pre` runs in installer environment (limited tools). Use bash with `read` for interactive prompts\n- `%post` (default) runs in chroot. `%post --nochroot` accesses installer env as `/mnt/sysimage/`\n- `REPO_URL` is a placeholder the user must edit before writing USB\n- Do NOT use `autopart` with manual `part` commands \u2014 they're mutually exclusive\n\n## Acceptance\n\n- [ ] Kickstart file targets `mmcblk0` eMMC with GPT partitioning\n- [ ] EFI + root partitions created (no swap), plain ext4\n- [ ] `%pre` prompts for username interactively\n- [ ] `%post` clones repo to `/home/<user>/surface-linux` and sets correct ownership\n- [ ] `REPO_URL` placeholder clearly documented for user to edit\n- [ ] `rootpw --lock` used (no root password)\n- [ ] Minimal Install package group selected (no desktop/display manager)\n- [ ] README covers USB preparation with both methods (USB partition, HTTP)\n- [ ] README includes boot parameter examples\n- [ ] README includes post-install instructions (login \u2192 install.sh \u2192 reboot)\n- [ ] No deprecated kickstart commands used\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:09:05.828881Z",
        "depends_on": [
          "fn-1-surface-go-3-fedora-install-script.1"
        ],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.4",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.4.md",
        "status": "todo",
        "title": "System configuration: zram, network, getty, plymouth, and services",
        "updated_at": "2026-02-08T08:25:14.723807Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.4",
      "runtime": null,
      "spec": "## Description\n\nCreate lib scripts for the `zram`, `network`, `desktop`, and `services` install stages. These handle system-level configuration that runs after packages are installed and downloads are complete.\n\n**Size:** M\n**Files:** `lib/05-zram.sh`, `lib/06-network.sh`, `lib/07-desktop.sh`, `lib/11-services.sh`\n\n## Approach\n\n### lib/05-zram.sh (`run_zram`)\n- Write `/etc/systemd/zram-generator.conf` with `zram-size = ram` (4GB device \u2192 4GB zram) and `compression-algorithm = zstd`\n- Write `/etc/sysctl.d/99-zram.conf` with tuned values: `vm.swappiness=180`, `vm.watermark_boost_factor=0`, `vm.watermark_scale_factor=125`, `vm.page-cluster=0`\n- Idempotent: overwrite files (same content on re-run)\n- Note: takes effect after reboot only\n\n### lib/06-network.sh (`run_network`)\n- Create `/etc/NetworkManager/conf.d/wifi-backend.conf` with `[device]\\nwifi.backend=iwd`\n- Do NOT enable `iwd.service` manually \u2014 NetworkManager manages it\n- Run `restorecon -R /etc/NetworkManager` after writing conf.d files (SELinux)\n- This stage runs AFTER all downloads are complete (switching to iwd drops wpa_supplicant WiFi)\n\n### lib/07-desktop.sh (`run_desktop`)\n- Getty auto-login override: write systemd drop-in for `getty@tty1.service`\n  - Blank `ExecStart=` line REQUIRED before new one\n  - Use single-quoted heredoc to preserve `$TERM` literal\n  - Run `systemctl daemon-reload` after\n- Plymouth theme: check current theme with `plymouth-set-default-theme`, only rebuild initrd with `-R` if theme changed (saves ~30s)\n- XDG portal config: write `~/.config/xdg-desktop-portal/portals.conf` with `[preferred]\\ndefault=hyprland`\n- UWSM env files: create `~/.config/uwsm/env` for theming vars (XDG_CURRENT_DESKTOP, XCURSOR_THEME, etc.)\n- Create `~/.config/uwsm/env-hyprland` for Hyprland-specific vars\n- Create `~/.config/environment.d/surface-linux.conf` for systemd user env vars\n\n### lib/11-services.sh (`run_services`)\n- Enable services: `iptsd`, `NetworkManager`, `bluetooth`, `tuned`\n- Enable tuned-ppd for powerprofilesctl CLI compatibility\n- Idempotent: `systemctl enable` is already idempotent (no error if already enabled)\n\n## Key context\n\n- Getty override uses systemd drop-in at `/etc/systemd/system/getty@tty1.service.d/override.conf`, NOT editing the unit file\n- `restorecon` is critical for SELinux \u2014 NetworkManager conf.d files without correct context will be ignored\n- UWSM env vars go in `~/.config/uwsm/env` (all compositors) and `~/.config/uwsm/env-hyprland` (Hyprland-specific), NOT in `hyprland.conf`\n- Do NOT use `exit` dispatcher under UWSM \u2014 use `uwsm stop` for clean shutdown\n- Fedora 43 uses `tuned + tuned-ppd` instead of `power-profiles-daemon` (same `powerprofilesctl` CLI)\n\n## Acceptance\n\n- [ ] zram configured to `ram` size with zstd compression\n- [ ] sysctl tuned for zram-heavy workload (swappiness=180)\n- [ ] NetworkManager configured for iwd backend with SELinux contexts fixed\n- [ ] iwd.service NOT manually enabled (NetworkManager manages it)\n- [ ] Getty auto-login override correct (blank ExecStart, single-quoted heredoc, daemon-reload)\n- [ ] Plymouth theme set only if changed (skip initrd rebuild when unchanged)\n- [ ] XDG portal config points to hyprland\n- [ ] UWSM env files created with correct theming variables\n- [ ] All services enabled: iptsd, NetworkManager, bluetooth, tuned\n- [ ] Idempotent: re-running produces no errors, no duplicate entries\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:09:06.017113Z",
        "depends_on": [
          "fn-1-surface-go-3-fedora-install-script.1"
        ],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.5",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.5.md",
        "status": "todo",
        "title": "Theme engine: template processor, colors.toml, and all templates",
        "updated_at": "2026-02-08T08:25:39.875144Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.5",
      "runtime": null,
      "spec": "## Description\n\nCreate the Omarchy-inspired template engine that reads `colors.toml` and processes `.tpl` template files to generate themed configuration files. Also create `colors.toml` (Tokyo Night) and all `.tpl` template files.\n\n**Size:** M\n**Files:** `lib/08-theme.sh`, `colors.toml`, `templates/*.tpl`, add generated files to `.gitignore`\n\n## Approach\n\n### lib/08-theme.sh (`run_theme`)\n- Parse `colors.toml` (flat `key = \"value\"` format) with awk \u2014 no external tools needed for this simple format\n- For each key-value pair, generate 3 sed substitution variants:\n  - `{{ key }}` \u2192 raw value (e.g., `#7aa2f7`)\n  - `{{ key_strip }}` \u2192 without `#` prefix (e.g., `7aa2f7`) for Hyprland `rgb()` format\n  - `{{ key_rgb }}` \u2192 decimal R,G,B (e.g., `122,162,247`) for CSS/configs needing decimal\n- `hex_to_rgb()` function: extract 3 two-char hex pairs, convert via `printf` with `0x` prefix\n- Escape replacement values for sed: handle `\\`, `&`, `/` characters\n- Process all `.tpl` files from `templates/` directory\n- Output processed files INTO the repo's `config/` directory (they get symlinked by dotfiles.sh)\n- Idempotent: overwrites output files with same content on re-run\n\n### colors.toml (Tokyo Night)\n- Full 16-color palette + accent, cursor, foreground, background, selection colors\n- Follow Omarchy format exactly for compatibility with the template system\n\n### Templates (*.tpl)\nCreate `.tpl` files for each themed application:\n- `templates/hyprland-colors.conf.tpl` \u2014 Hyprland border colors, group colors\n- `templates/waybar-colors.css.tpl` \u2014 Waybar CSS color variables\n- `templates/ghostty-theme.tpl` \u2014 Ghostty palette and colors\n- `templates/mako-colors.conf.tpl` \u2014 Mako notification colors\n- `templates/tofi-colors.conf.tpl` \u2014 Tofi launcher colors\n- `templates/hyprlock-colors.conf.tpl` \u2014 Hyprlock lock screen colors\n- `templates/gtk-settings.ini.tpl` \u2014 GTK3/4 settings.ini (dark theme)\n\n## Key context\n\n- Template output goes to `config/` directory (e.g., `templates/ghostty-theme.tpl` \u2192 `config/ghostty/theme`), then `dotfiles.sh` symlinks from `~/.config/`\n- Use `|` as sed delimiter instead of `/` when values contain slashes (file paths)\n- Do NOT use `envsubst` \u2014 it replaces ALL `$VAR` patterns including literal shell vars in configs\n- Do NOT use `eval` or `echo -e` in template processing (shell injection risk)\n- Generated files in `config/` must be added to `.gitignore` (already created in Task 1)\n- GTK theme must use `settings.ini` files, NOT `gsettings`/`dconf` (no DBus session on TTY)\n\n## Acceptance\n\n- [ ] `colors.toml` contains full Tokyo Night palette (16 colors + accent/cursor/fg/bg/selection)\n- [ ] Template processor reads `colors.toml` and generates all 3 variants per key (`{{ key }}`, `{{ key_strip }}`, `{{ key_rgb }}`)\n- [ ] `hex_to_rgb()` correctly converts hex to decimal R,G,B\n- [ ] sed replacement values properly escaped (handles `\\`, `&`, `/`)\n- [ ] All `.tpl` files processed and output to `config/` directory\n- [ ] Generated config files added to `.gitignore`\n- [ ] Tokyo Night colors applied consistently across all templates\n- [ ] Idempotent: re-running overwrites to same content, no accumulation\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:09:06.193706Z",
        "depends_on": [
          "fn-1-surface-go-3-fedora-install-script.1"
        ],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.6",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.6.md",
        "status": "todo",
        "title": "Hyprland 0.53+, app configs (waybar, mako, ghostty, tofi, hyprlock), and Neovim/LazyVim",
        "updated_at": "2026-02-08T08:26:16.446869Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.6",
      "runtime": null,
      "spec": "## Description\n\nCreate all application configuration files for Hyprland 0.53+ and companion apps, plus the Neovim/LazyVim setup. These are static config files (non-themed parts) that live in `config/` and get symlinked to `~/.config/` by dotfiles.sh.\n\n**Size:** M (largest task \u2014 many config files, but follows established patterns)\n**Files:** `config/hypr/hyprland.conf`, `config/hypr/hypridle.conf`, `config/hypr/hyprlock.conf`, `config/hypr/hyprpaper.conf`, `config/waybar/config.jsonc`, `config/waybar/style.css`, `config/mako/config`, `config/ghostty/config`, `config/tofi/config`, `config/nvim/init.lua`, `config/nvim/lua/config/lazy.lua`, `config/nvim/lua/config/options.lua`, `config/nvim/lua/plugins/colorscheme.lua`, `lib/09-neovim.sh`\n\n## Approach\n\n### Hyprland config (`config/hypr/hyprland.conf`)\n- Use **0.53+ windowrule syntax** throughout: `windowrule = ..., match:class ...` (anonymous) or named blocks\n- Do NOT use deprecated `windowrulev2`\n- Source themed colors from a separate file (generated by theme engine): `source = ~/.config/hypr/colors.conf`\n- Monitor config for Surface Go 3 (10.5\" 1920x1280)\n- Input config: touchpad, keyboard layout\n- Keybinds: workspace switching, window management, app launchers\n  - `bindel` for volume/brightness (repeatable)\n  - `bindl` for media play/pause (works on lockscreen)\n  - Screenshots: `grim -g \"$(slurp)\"` via `sh -c` wrapper (complex pipe needs shell)\n  - Clipboard history: `cliphist list | tofi | cliphist decode | wl-copy` via helper script in `~/.local/bin/`\n- `exec-once` for session daemons: waybar, mako, hyprpaper, hyprpolkitagent, `wl-paste --watch cliphist store`\n- Do NOT use `exit` dispatcher (UWSM manages session) \u2014 use `uwsm stop`\n- Set `misc:disable_hyprland_guiutils_check = false`\n\n### hypridle.conf\n- Lock screen at 5 minutes idle (`hyprlock`)\n- Suspend at 15 minutes idle (`systemctl suspend`)\n- DPMS off at 10 minutes\n\n### hyprlock.conf\n- Lock screen styling with Tokyo Night colors (from template-generated file)\n- Clock, date, password input field\n\n### hyprpaper.conf\n- Reference wallpapers from `~/.local/share/wallpapers/surface-linux/` (stable absolute paths)\n\n### Waybar (`config/waybar/config.jsonc` + `config/waybar/style.css`)\n- Single bar, top position\n- Modules: workspaces, clock, battery, network, bluetooth, audio, tray\n- Style with Tokyo Night colors (CSS imports from template-generated file)\n\n### Mako (`config/mako/config`)\n- Tokyo Night colors from template, timeout, default position\n\n### Ghostty (`config/ghostty/config`)\n- Tokyo Night theme (from template-generated file), font settings, window padding\n\n### Tofi (`config/tofi/config`)\n- Tokyo Night colors from template, font, dimensions\n\n### Neovim (`config/nvim/` + `lib/09-neovim.sh`)\n- LazyVim bootstrap: `init.lua` with lazy.nvim clone from `--branch=stable`\n- `lua/config/lazy.lua`: LazyVim setup options\n- `lua/config/options.lua`: vim options\n- `lua/plugins/colorscheme.lua`: Tokyo Night with `priority = 1000`, `lazy = false`, style = \"night\"\n- `lib/09-neovim.sh` (`run_neovim`): Ensure `~/.local/share/nvim/lazy/lazy.nvim` exists (clone if not), headless plugin install\n\n## Key context\n\n- Hyprland 0.53+: `windowrule` not `windowrulev2`. Use `match:class` prefix. Migration tool at https://itsohen.github.io/hyprrulefix/\n- Complex keybinds with pipes/subshells MUST use `sh -c` wrapper or helper scripts in `~/.local/bin/`\n- `exec-once` for daemons (run at session start). `exec` re-runs on every config reload \u2014 avoid for daemons\n- LazyVim v15.x requires Neovim >= 0.11.2 \u2014 verify Fedora 43 ships this version; if not, pin LazyVim v14.x\n- Do NOT set `lazy = true` for active colorscheme (defeats purpose). Use `lazy = false` + `priority = 1000`\n- Config files reference template-generated color files via `source` or `@import` \u2014 those are created by Task 5\n\n## Acceptance\n\n- [ ] `hyprland.conf` uses 0.53+ `windowrule` syntax throughout (zero `windowrulev2` usage)\n- [ ] All keybinds work: workspaces, window management, volume, brightness, screenshots, clipboard\n- [ ] Screenshots use `grim -g \"$(slurp)\"` with proper `sh -c` wrapper\n- [ ] Clipboard history chain: `cliphist list | tofi | cliphist decode | wl-copy`\n- [ ] `exec-once` starts: waybar, mako, hyprpaper, hyprpolkitagent, cliphist watcher\n- [ ] hypridle: lock at 5min, DPMS off at 10min, suspend at 15min\n- [ ] hyprlock: styled with Tokyo Night colors, clock + password input\n- [ ] Waybar: single top bar with workspaces, clock, battery, network, bluetooth, audio, tray\n- [ ] Mako, Ghostty, Tofi configured with Tokyo Night theme\n- [ ] Neovim: LazyVim bootstrapped with Tokyo Night colorscheme\n- [ ] `run_neovim` clones lazy.nvim if missing, runs headless plugin install\n- [ ] No hardcoded color values in main configs (all sourced from template-generated files)\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-02-06T23:09:06.380276Z",
        "depends_on": [
          "fn-1-surface-go-3-fedora-install-script.5",
          "fn-1-surface-go-3-fedora-install-script.6"
        ],
        "epic": "fn-1-surface-go-3-fedora-install-script",
        "id": "fn-1-surface-go-3-fedora-install-script.7",
        "priority": null,
        "spec_path": ".flow/tasks/fn-1-surface-go-3-fedora-install-script.7.md",
        "status": "todo",
        "title": "Config deployment: dotfiles symlinks, .bashrc aliases, wallpapers, and UWSM",
        "updated_at": "2026-02-08T08:26:39.884841Z"
      },
      "id": "fn-1-surface-go-3-fedora-install-script.7",
      "runtime": null,
      "spec": "## Description\n\nCreate the dotfiles deployment script that symlinks config files from the repo to `~/.config/`, deploys shell aliases, copies wallpapers, sets up the UWSM auto-start snippet, and creates helper scripts.\n\n**Size:** M\n**Files:** `lib/10-dotfiles.sh`, `config/bashrc.d/aliases.sh`, `config/bashrc.d/uwsm.sh`, `scripts/clipboard-history.sh`\n\n## Approach\n\n### lib/10-dotfiles.sh (`run_dotfiles`)\n- Symlink all directories in `config/` to `~/.config/` using `ln -snf` (with `-n` to prevent nested symlinks)\n- Handle Neovim specially: symlink `config/nvim/` \u2192 `~/.config/nvim/`\n- Create `~/.local/bin/` and add helper scripts (clipboard history, screenshot)\n- Copy wallpapers from `assets/wallpapers/` \u2192 `~/.local/share/wallpapers/surface-linux/` (stable absolute paths for hyprpaper)\n- Deploy `.bashrc` additions:\n  - Source all files from `~/.config/bashrc.d/*.sh` pattern (append sourcing loop to `.bashrc` if not present)\n  - Guard with `grep -qF` before appending to prevent duplicates on re-run\n- Deploy UWSM auto-start to `~/.bash_profile`:\n  - Add `uwsm check may-start && exec uwsm start hyprland.desktop` snippet\n  - Must go in `~/.bash_profile` NOT `.bashrc` (login shell only)\n  - Guard with `grep -qF` before appending\n\n### config/bashrc.d/aliases.sh\n- `n` \u2192 `nvim`\n- `ll` \u2192 `ls -la`\n- `la` \u2192 `ls -A`\n- `..` \u2192 `cd ..`\n- Other quality-of-life aliases\n\n### scripts/clipboard-history.sh\n- Helper for clipboard history keybind: `cliphist list | tofi | cliphist decode | wl-copy`\n- Made executable, symlinked to `~/.local/bin/`\n\n### Symlink mapping\n```\nconfig/hypr/        \u2192 ~/.config/hypr/\nconfig/waybar/      \u2192 ~/.config/waybar/\nconfig/mako/        \u2192 ~/.config/mako/\nconfig/ghostty/     \u2192 ~/.config/ghostty/\nconfig/tofi/        \u2192 ~/.config/tofi/\nconfig/nvim/        \u2192 ~/.config/nvim/\nconfig/bashrc.d/    \u2192 ~/.config/bashrc.d/\n```\n\n## Key context\n\n- Use `ln -snf` (not `ln -sf`) \u2014 without `-n`, if target is already a symlink to a directory, `ln -sf` traverses into it and creates nested link inside\n- `.bashrc` sourcing loop: iterate `~/.config/bashrc.d/*.sh` files. This keeps `.bashrc` modifications minimal and modular\n- `.bash_profile` UWSM snippet must NOT be in `.bashrc` \u2014 it would try to start Hyprland on every subshell\n- Guard all `.bashrc`/`.bash_profile` appends with `grep -qF` to prevent duplicate entries on re-run\n- Wallpapers MUST be copied (not symlinked) to `~/.local/share/wallpapers/surface-linux/` \u2014 hyprpaper needs stable absolute paths that work even if repo moves\n- File ownership: all files under `~/.config/`, `~/.local/` should be owned by the user (not root)\n\n## Acceptance\n\n- [ ] All config directories symlinked: hypr, waybar, mako, ghostty, tofi, nvim, bashrc.d\n- [ ] Symlinks use `ln -snf` (no nested symlinks on re-run)\n- [ ] Wallpapers copied to `~/.local/share/wallpapers/surface-linux/`\n- [ ] Shell aliases working: `n`=nvim, `ll`, `la`, `..`\n- [ ] `.bashrc` sources `~/.config/bashrc.d/*.sh` (no duplicates on re-run)\n- [ ] `.bash_profile` contains UWSM auto-start snippet (no duplicates on re-run)\n- [ ] Clipboard history helper script in `~/.local/bin/` and executable\n- [ ] All `~/.config/` and `~/.local/` files owned by user (not root)\n- [ ] Idempotent: re-running produces correct symlinks, no duplicate .bashrc entries\n\n## Done summary\n\n_To be filled after implementation._\n\n## Evidence\n\n_To be filled after implementation._\n"
    }
  ]
}
